# Backend Infrastructure Documentation\n# Adam James Tulsa Website\n\nThis document provides a comprehensive overview of the backend infrastructure implemented for adamjamestulsa.com, detailing all API routes, integrations, security measures, and monitoring systems.\n\n## Architecture Overview\n\nThe backend infrastructure is built on Next.js 15 with the App Router pattern, providing:\n- **Serverless Functions**: Auto-scaling API routes\n- **Edge Runtime**: Global distribution for optimal performance\n- **TypeScript**: Full type safety across all backend code\n- **Zod Validation**: Runtime schema validation\n- **Rate Limiting**: Built-in protection against abuse\n- **Comprehensive Monitoring**: Error tracking and performance metrics\n\n## API Routes Structure\n\n```\napp/api/\n├── admin/\n│   └── dashboard/          # Admin dashboard data\n├── analytics/\n│   ├── event/             # Custom event tracking\n│   └── pageview/          # Page view tracking\n├── appointment/           # Appointment booking\n├── contact/              # Contact form submissions\n├── newsletter/           # Newsletter signups\n├── rss/                 # RSS feed generation\n├── search/              # Site search functionality\n├── services/\n│   ├── inquiry/          # Service-specific inquiries\n│   └── quote/           # Quote requests\n├── sitemap/             # Dynamic sitemap generation\n├── social-proof/        # Social media integration\n├── monitoring/\n│   ├── error/           # Error reporting\n│   └── performance/     # Performance metrics\n└── health/              # Health check endpoint\n```\n\n## Core API Endpoints\n\n### Contact Form API (`/api/contact`)\n**Purpose**: Handle contact form submissions with email notifications\n\n**Methods**:\n- `POST`: Submit contact form\n- `GET`: Retrieve contact submissions (admin)\n- `OPTIONS`: CORS preflight\n\n**Features**:\n- Zod schema validation\n- Rate limiting (5 submissions per 15 minutes)\n- Dual email system (admin notification + user confirmation)\n- Spam protection\n- IP tracking and metadata collection\n- Storage in Vercel KV\n\n**Request Schema**:\n```typescript\n{\n  firstName: string (2-50 chars)\n  lastName: string (2-50 chars)\n  email: string (valid email)\n  phone?: string (optional, regex validated)\n  company?: string (optional, max 100 chars)\n  message: string (10-2000 chars)\n  service?: 'integrity-stone' | 'safe-harbor' | 'growthgenix' | 'consultation' | 'other'\n  urgency: 'low' | 'medium' | 'high' | 'urgent'\n  source?: string (optional)\n  preferredContact: 'email' | 'phone' | 'both'\n}\n```\n\n### Newsletter API (`/api/newsletter`)\n**Purpose**: Handle newsletter subscriptions\n\n**Features**:\n- Email validation and deduplication\n- Welcome email automation\n- Interest tracking\n- Source attribution\n- Unsubscribe handling\n\n### Appointment API (`/api/appointment`)\n**Purpose**: Schedule appointments and consultations\n\n**Features**:\n- Calendar integration ready\n- Timezone handling\n- Meeting type selection (in-person, video, phone)\n- Service-specific routing\n- Confirmation emails\n\n### Analytics APIs (`/api/analytics/*`)\n**Purpose**: Custom analytics tracking beyond Google Analytics\n\n**Endpoints**:\n- `/api/analytics/pageview`: Track page views with custom metadata\n- `/api/analytics/event`: Track custom events and user interactions\n\n**Features**:\n- Session tracking\n- User journey mapping\n- Custom event parameters\n- Performance correlation\n\n### Monitoring APIs (`/api/monitoring/*`)\n**Purpose**: Application health and performance monitoring\n\n**Endpoints**:\n- `/api/monitoring/error`: Error reporting and tracking\n- `/api/monitoring/performance`: Performance metrics collection\n- `/api/health`: Comprehensive health checks\n\n## Email Integration (Resend)\n\n### Configuration\n- **Service**: Resend API\n- **Domain**: adamjamestulsa.com\n- **From Address**: noreply@adamjamestulsa.com\n- **Admin Email**: adam@adamjamestulsa.com\n\n### Email Templates\n\n#### Contact Form Notifications\n- **Admin Notification**: Rich HTML with urgency indicators, contact details, and action items\n- **User Confirmation**: Professional confirmation with response time expectations\n\n#### Newsletter Welcome\n- **Welcome Email**: Branded template with service highlights and next steps\n- **Unsubscribe**: Automatic handling with confirmation\n\n#### Appointment Confirmations\n- **Booking Confirmation**: Calendar-ready format with meeting details\n- **Reminder System**: Automated reminders (configurable)\n\n### Email Features\n- **HTML Templates**: Responsive design with inline CSS\n- **Personalization**: Dynamic content based on user data\n- **Tracking**: Open rates and click tracking\n- **Deliverability**: SPF, DKIM, and DMARC configured\n\n## Database Layer (Vercel KV)\n\n### Storage Structure\n```\nStorage Keys:\n├── contact_forms:*        # Contact submissions\n├── newsletter_subscribers:* # Newsletter emails\n├── appointments:*         # Appointment bookings\n├── page_views:*          # Analytics page views\n├── events:*              # Custom events\n├── performance_metrics:* # Performance data\n├── error_reports:*       # Error tracking\n├── rate_limit:*          # Rate limiting counters\n└── daily_pageviews:*     # Daily statistics\n```\n\n### Storage Classes\n- **Storage**: Generic storage interface\n- **ContactFormStorage**: Contact form specific operations\n- **NewsletterStorage**: Newsletter subscriber management\n- **AppointmentStorage**: Appointment data handling\n- **AnalyticsStorage**: Analytics data aggregation\n- **SearchStorage**: Search query tracking\n\n### Features\n- **Automatic Indexing**: Time-based sorting\n- **Expiration**: TTL for temporary data\n- **Atomic Operations**: Consistent data updates\n- **Backup Ready**: Export/import capabilities\n\n## Security Implementation\n\n### Rate Limiting\n- **Implementation**: Vercel KV based with IP tracking\n- **Limits**:\n  - Contact forms: 5 per 15 minutes\n  - Newsletter: 3 per hour\n  - API calls: 100 per 15 minutes\n  - Error reports: 10 per minute\n\n### Input Validation\n- **Schema Validation**: Zod schemas for all inputs\n- **Sanitization**: HTML and SQL injection prevention\n- **Type Safety**: TypeScript enforcement\n- **Regular Expressions**: Phone number and email validation\n\n### Security Headers\n```typescript\nX-Content-Type-Options: nosniff\nX-Frame-Options: DENY\nX-XSS-Protection: 1; mode=block\nReferrer-Policy: strict-origin-when-cross-origin\nContent-Security-Policy: default-src 'self'\n```\n\n### CSRF Protection\n- **Token Generation**: Cryptographically secure tokens\n- **Validation**: Header and cookie verification\n- **Exemptions**: Safe methods (GET, HEAD, OPTIONS)\n\n### CORS Configuration\n- **Allowed Origins**: adamjamestulsa.com domains only\n- **Methods**: Restricted per endpoint\n- **Headers**: Content-Type and Authorization only\n\n## Third-Party Integrations\n\n### Google Analytics 4\n**File**: `lib/integrations/analytics.ts`\n\n**Features**:\n- **Event Tracking**: Custom events for business actions\n- **Ecommerce**: Enhanced ecommerce for service tracking\n- **Performance**: Core Web Vitals monitoring\n- **Conversion Tracking**: Goal and conversion measurement\n\n**Custom Events**:\n```typescript\n- contactFormSubmission(service, urgency)\n- newsletterSignup(source)\n- servicePageView(service)\n- locationPageView(location)\n- phoneClick(source)\n- emailClick(source)\n- fileDownload(fileName, fileType)\n- siteSearch(query, resultsCount)\n```\n\n### Google Maps Integration\n**File**: `lib/integrations/google-maps.ts`\n\n**Features**:\n- **Location Maps**: 20 Tulsa area locations\n- **Custom Styling**: Branded map appearance\n- **Info Windows**: Business information overlays\n- **Directions**: Route calculation and display\n- **Geocoding**: Address to coordinates conversion\n\n**Location Coverage**:\n- Downtown Tulsa, Midtown, South Tulsa\n- Broken Arrow, Jenks, Bixby, Owasso\n- Sand Springs, Sapulpa, Glenpool\n- Claremore, Catoosa, Collinsville\n- And 7 additional metro areas\n\n### Monitoring and Error Tracking\n**File**: `lib/integrations/monitoring.ts`\n\n**Components**:\n- **ErrorTracker**: Global error capture and reporting\n- **PerformanceMonitor**: Core Web Vitals and load time tracking\n- **SessionTracker**: User session and journey tracking\n\n**Features**:\n- **Real-time Monitoring**: Instant error reporting\n- **Performance Metrics**: Automated performance data collection\n- **User Sessions**: Comprehensive user behavior tracking\n- **Health Checks**: System status monitoring\n\n## Configuration Management\n\n### Environment Variables\n**File**: `lib/config.ts`\n\n**Categories**:\n- **Email**: Resend API configuration\n- **Database**: Vercel KV connection strings\n- **Analytics**: Google Analytics and tracking IDs\n- **Security**: API keys and secrets\n- **External APIs**: Google Maps, social media\n- **Features**: Feature flags and toggles\n- **Business**: Contact information and settings\n\n### Validation\n- **Required Variables**: Automatic validation on startup\n- **Type Conversion**: String to number/boolean conversion\n- **Default Values**: Sensible defaults for optional variables\n- **Error Handling**: Clear error messages for missing config\n\n## API Response Standards\n\n### Success Response Format\n```typescript\n{\n  success: true,\n  data: T,\n  message?: string,\n  timestamp: string\n}\n```\n\n### Error Response Format\n```typescript\n{\n  success: false,\n  error: string,\n  code?: string,\n  timestamp: string\n}\n```\n\n### Validation Error Format\n```typescript\n{\n  success: false,\n  error: \"Validation failed\",\n  code: \"VALIDATION_ERROR\",\n  data: {\n    errors: Record<string, string[]>\n  },\n  timestamp: string\n}\n```\n\n## Performance Optimization\n\n### Caching Strategy\n- **KV Caching**: Frequently accessed data\n- **Static Generation**: Pre-built pages where possible\n- **Edge Caching**: CDN optimization\n- **API Response Caching**: Short-term caching for expensive operations\n\n### Database Optimization\n- **Connection Pooling**: Automatic with Vercel KV\n- **Query Optimization**: Indexed lookups\n- **Batch Operations**: Multiple operations in single request\n- **TTL Management**: Automatic cleanup of expired data\n\n### Memory Management\n- **Lazy Loading**: Dynamic imports for large modules\n- **Resource Cleanup**: Proper disposal of resources\n- **Memory Monitoring**: Built-in memory usage tracking\n\n## Error Handling\n\n### Error Classification\n- **Validation Errors**: User input issues (400)\n- **Authentication Errors**: Access denied (401/403)\n- **Rate Limit Errors**: Too many requests (429)\n- **Server Errors**: Internal issues (500)\n- **External Service Errors**: Third-party failures (502/503)\n\n### Error Recovery\n- **Retry Logic**: Exponential backoff for external services\n- **Fallback Mechanisms**: Graceful degradation\n- **Circuit Breakers**: Prevent cascade failures\n- **Error Logging**: Comprehensive error tracking\n\n## Monitoring and Alerting\n\n### Health Monitoring\n- **Endpoint**: `/api/health`\n- **Checks**: Database, email service, memory usage\n- **Response Times**: All components under 500ms\n- **Status Codes**: 200 (healthy), 503 (unhealthy)\n\n### Performance Monitoring\n- **Core Web Vitals**: LCP, FID, CLS tracking\n- **Load Times**: Page and API response times\n- **Error Rates**: 4xx and 5xx error tracking\n- **User Sessions**: Session duration and engagement\n\n### Alerting Thresholds\n- **Error Rate**: >1% triggers alert\n- **Response Time**: >2s triggers warning\n- **Memory Usage**: >90% triggers alert\n- **Failed Health Checks**: Immediate notification\n\n## Development Workflow\n\n### Local Development\n```bash\nnpm run dev          # Start development server\nnpm run lint         # Code quality checks\nnpm run build        # Production build test\nnpm run lighthouse   # Performance audit\n```\n\n### Testing\n- **API Testing**: All endpoints have example requests\n- **Validation Testing**: Schema validation tests\n- **Integration Testing**: End-to-end email and database tests\n- **Performance Testing**: Automated Lighthouse audits\n\n### Deployment\n- **Preview Deployments**: Automatic on PR creation\n- **Production Deployment**: Automatic on main branch merge\n- **Rollback**: One-click rollback via Vercel dashboard\n- **Environment Sync**: Separate staging and production configs\n\n## Business Logic Implementation\n\n### Service Routing\nDifferent email addresses and handling based on service type:\n- **Integrity Stone**: Construction inquiries\n- **Safe Harbor**: Financial service requests  \n- **GrowthGenix**: Marketing consultation requests\n\n### Urgency Handling\nResponse time expectations based on urgency level:\n- **Urgent**: 1 hour response time\n- **High**: 4 hour response time\n- **Medium/Low**: 24 hour response time\n\n### Location-Specific Features\n- **20 Location Pages**: Each with unique content and maps\n- **Local SEO**: Location-specific schema markup\n- **Service Area**: All Tulsa metropolitan area\n\n## Scalability Considerations\n\n### Auto-Scaling\n- **Serverless Functions**: Automatic scaling based on demand\n- **Database**: Vercel KV scales automatically\n- **CDN**: Global edge distribution\n\n### Performance Targets\n- **Response Time**: <500ms for 95% of requests\n- **Throughput**: 1000+ requests per minute\n- **Uptime**: 99.9% availability\n- **Error Rate**: <0.1% for all endpoints\n\n### Monitoring Scale\n- **Data Retention**: 30 days for detailed metrics\n- **Aggregation**: Hourly/daily rollups for long-term analysis\n- **Storage Optimization**: Automatic cleanup of old data\n\n## Security Compliance\n\n### Data Protection\n- **PII Handling**: Minimal collection, secure storage\n- **Data Retention**: Configurable retention periods\n- **Access Control**: Admin-only access to sensitive data\n- **Audit Trail**: All data access logged\n\n### API Security\n- **Input Validation**: All inputs validated and sanitized\n- **Output Encoding**: XSS prevention\n- **SQL Injection**: Parameterized queries only\n- **Rate Limiting**: Abuse prevention\n\n## Maintenance and Updates\n\n### Regular Maintenance\n- **Weekly**: Performance review and optimization\n- **Monthly**: Security updates and dependency upgrades\n- **Quarterly**: Full security audit and penetration testing\n\n### Update Process\n- **Dependencies**: Automated security updates\n- **API Changes**: Versioned with backward compatibility\n- **Database Migrations**: Automated with rollback capability\n- **Configuration**: Environment variable management\n\nThis backend infrastructure provides a robust, secure, and scalable foundation for the Adam James Tulsa website, designed to handle business growth while maintaining excellent performance and user experience."